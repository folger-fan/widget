## 需求背景
产品要做一个H5广告页，上下滑动翻页的那种。第一页和第二页视频想自动播放。
## 初步完成情况
#### 自动播放

移动端为了避免浪费用户流量，一般是禁止H5视频自动播放，其他手机浏览器没试过，在微信上直接代码播放视频是不行的。必须要有用户的事件触发。

其中在安卓端，可监听touchend事件播放视频，不管用户是点击后的touchend还是touchmove后的touchend。

在iOS端，必须是用户点击后才能播放视频。

#### 滑倒第二页后播放

经过尝试，安卓端只要用户触摸了页面，后面不管什么时候都可以播放视频。所以这个需求在安卓端没问题。

iOS没解决

## 继续努力
产品不死心，咨询了很多其他部门的同事，拉了些群一起探讨。（给产品的坚持点赞）

本人也尝试过一些办法，网上也搜了一些页面。

现总结下这几天沉淀下来的一些小技巧。

#### 微信的WeixinJSBridgeReady事件
在公司code平台搜H5 video的相关库，看到一个库的demo在iOS微信上可自动播放，大为惊讶。翻看源码，发现里面监听微信的WeixinJSBridgeReady事件，可在这个事件中播放视频。安卓上不行。


#### 图片切换模拟视频

微众银行的一位大神提供了一个方案，后台将视频转换成一张张图片，前端页面将页面加载完成后像放电影一样一张一张切换，效果还不错。

安卓微信上H5可自动播放声音，iOS微信上H5可监听WeixinJSBridgeReady事件播放声音。

也就是说自动播放视频和自动播放声音都解决了。不过我们担心声音和画面对不上，要两者结合起来的话要做的事情还有很多。就没有继续尝试，有兴趣的同学可以深入研究下。

#### 视频播放后，代码可主动播放视频

经过微众那位大神的提醒，我们发现不管安卓还是iOS，视频播放成功一次后，代码可主动播放视频。

根据这一点，可解决在iOS上滑倒第二页视频主动播放的问题。

首先iOS微信H5中监听 WeixinJSBridgeReady 事件，播放视频，video监听onplay事件暂停视频。滑倒第二页后再主动播放视频。
具体代码如下

```
        if (IOS) {
            this.video.onplay = () => {
                this.video.pause();
                this.video.onplay = null;
            };
            document.addEventListener("WeixinJSBridgeReady", () => {
                this.video.play();
            }, false);
        }
```
需要注意的是，一定要视频播放成功后，也就是在onplay事件触发后才能暂停视频，播放马上暂停没用的。

## 总结

先反思下自己，做过尝试也搜了一些资料，内心对产品的坚持是反感的，认为上面两点需求没办法在两端都保证。但在其他部门的同事给出一个个建议并实践后，发现很多东西是不实践就很难知道的。虽然第一个需求在安卓上没满足，但第二个需求在两端都满足了，是一个很大的进步。

再者，移动端真的很多坑，不仅仅是H5的，还有小程序的。一开始听说小程序页面体验很好，产品想做小程序的，但原生组件如video的动画满足不了要求，还有其他一些问题，最终我们放弃了小程序。这里吐槽下小程序的开发，我们拉群向小程序开发反馈过一些问题，但没多少回应，对问题的解决也不积极。反观本人在使用QQ空间的TSW的时候反馈的问题，那边开发很快很积极的配合解决问题。这次产品找其他部门的人拉群探讨视频播放的问题，大家也都很积极的提出自己的想法和解决方案。

坑坑难过坑坑过，祝大家踩的坑越来越少！：）
